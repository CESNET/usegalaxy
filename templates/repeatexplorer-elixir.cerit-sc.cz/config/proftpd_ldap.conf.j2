#
# Proftpd sample configuration for LDAP authentication.
#
# (This is not to be used if you prefer a PAM-based LDAP authentication)
#

##DEMON: I put it here, because it should be somewhere if proftpd_galaxy_auth is not defined (i.e., used)
# Deny use of commands that allow modifying modification times and retrieving files
<Limit SITE_CHMOD SITE_UTIME RETR MDTM MFMT MFCT MFF>
    DenyAll
</Limit>


# Enable LDAP module
LoadModule mod_ldap.c

#
# This is used for encrypted LDAPS connections
#
LDAPLog /var/log/proftpd/ldap.log
LDAPServer ldaps://perun.metacentrum.cz/??sub
LDAPBindDN "perunUserId={{ ldap_perun_user_id }},ou=People,dc=perun,dc=cesnet,dc=cz" "{{ ldap_user_password }}"
LDAPUsers "dc=perun,dc=cesnet,dc=cz" "(&(login=%v)(objectclass=perunUser)(memberof=perunGroupId={{ ldap_perun_group_id }},perunVoId={{ ldap_perun_vo_id }},dc=perun,dc=cesnet,dc=cz))"
LDAPSearchScope subtree
#set where to find attr                                                                                                                      
LDAPAttr uid login;x-ns-einfra
LDAPAttr uidNumber uidNumber;x-ns-cerit
#set uid to galaxyelixir and gid to meta                                                                                                    
LDAPDefaultUID {{ galaxy_user_id }}
LDAPForceDefaultUID     on
LDAPDefaultGID {{ galaxy_user_group_gid }}
LDAPForceDefaultGID     on
#set homedir creation                                                                                                                           
LDAPGenerateHomedir on 700
LDAPGenerateHomedirPrefix {{ galaxy_ftp_upload_dir }}/%u@{{ galaxy_users_domain }}
LDAPForceGeneratedHomedir on
LDAPGenerateHomedirPrefixNoUsername on

